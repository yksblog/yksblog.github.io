<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Linux下docker</title>
<meta name="generator" content="Org Mode" />
<link rel='shortcut icon' href='https://yangk.net/org_themes/favicon.ico' type='image/x-icon' />
           <link rel='stylesheet' href='https://yangk.net/org_themes/style.css' type='text/css'  />
           <script type='module' src='https://yangk.net/org_themes/main.js' defer></script>
<meta name="card" content="">
</head>
<body>
<div id="content" class="content">
<h1 class="title">Linux下docker</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org6258756">docker安装</a></li>
<li><a href="#org8ae6d28">docker-compose</a></li>
<li><a href="#orgaaaa67a">docker login</a></li>
<li><a href="#org94e7568">docker push</a></li>
<li><a href="#org3233b9b">Dockfile</a></li>
<li><a href="#orgf9ed515">常用命令</a>
<ul>
<li><a href="#orgf8295b6">help</a></li>
<li><a href="#org4d65341">通过Dockfile构建docker镜像</a></li>
<li><a href="#org5d8c10a">run</a></li>
<li><a href="#org2ebee1d">exec</a></li>
<li><a href="#orgdd94df9">save &amp;&amp; load &amp;&amp; tag</a></li>
<li><a href="#orgb7688bf">后台运行(-d)、并暴露端口(-p)</a></li>
<li><a href="#orga07df4e">从container中拷贝文件出来</a></li>
<li><a href="#org38d57e1">删除镜像报错(image has dependent child images)</a></li>
</ul>
</li>
<li><a href="#org6fe3fb9">踩坑</a>
<ul>
<li><a href="#org938cbb4">tw</a></li>
<li><a href="#org53e85bd">docker search 报错</a></li>
<li><a href="#org28272d7">harbor</a></li>
<li><a href="#org62ba19f">docker &#x2013;link</a></li>
</ul>
</li>
<li><a href="#orgba0f606">docker镜像加速</a></li>
<li><a href="#orgbd087be">检查加速器是否生效</a></li>
<li><a href="#org111215c">Docker Hub 镜像加速器列表</a></li>
<li><a href="#org3be8e65">延伸阅读</a></li>
</ul>
</div>
</div>

<div id="outline-container-org6258756" class="outline-2">
<h2 id="org6258756">docker安装</h2>
<div class="outline-text-2" id="text-org6258756">
<ul class="org-ul">
<li><a href="https://www.runoob.com/docker/ubuntu-docker-install.html">https://www.runoob.com/docker/ubuntu-docker-install.html</a></li>
</ul>
</div>
</div>

<div id="outline-container-org8ae6d28" class="outline-2">
<h2 id="org8ae6d28">docker-compose</h2>
<div class="outline-text-2" id="text-org8ae6d28">
<div class="org-src-container">
<pre class="src src-shell">
<span style="color: #75715E;"># </span><span style="color: #75715E;">github</span>
$ sudo curl -L <span style="color: #E6DB74;">"https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-$(</span><span style="color: #AE81FF; font-weight: bold;">uname -s</span><span style="color: #E6DB74;">)-$(</span><span style="color: #AE81FF; font-weight: bold;">uname -m</span><span style="color: #E6DB74;">)"</span> -o /usr/local/bin/docker-compose

<span style="color: #75715E;"># </span><span style="color: #75715E;">&#22269;&#20869;</span>
$ curl -L https://get.daocloud.io/docker/compose/releases/download/v2.4.1/docker-compose-<span style="color: #AE81FF; font-weight: bold;">`uname -s`</span>-<span style="color: #AE81FF; font-weight: bold;">`uname -m`</span> &gt; /usr/local/bin/docker-compose


<span style="color: #75715E;"># </span><span style="color: #75715E;">&#23558;&#21487;&#25191;&#34892;&#26435;&#38480;&#24212;&#29992;&#20110;&#20108;&#36827;&#21046;&#25991;&#20214;&#65306;</span>

$ sudo chmod +x /usr/local/bin/docker-compose

<span style="color: #75715E;"># </span><span style="color: #75715E;">&#21019;&#24314;&#36719;&#38142;&#65306;</span>

$ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose

<span style="color: #75715E;"># </span><span style="color: #75715E;">&#27979;&#35797;&#26159;&#21542;&#23433;&#35013;&#25104;&#21151;&#65306;</span>

$ docker-compose version
cker-compose version 1.24.1, build 4667896b

</pre>
</div>
</div>
</div>


<div id="outline-container-orgaaaa67a" class="outline-2">
<h2 id="orgaaaa67a">docker login</h2>
<div class="outline-text-2" id="text-orgaaaa67a">
<div class="org-src-container">
<pre class="src src-shell">
dk login -u yangk -p P@88w0rd harbor.devops.kubesphere.local:30280
dk login -u admin -p Harbor12345 harbor.devops.kubesphere.local:30280

</pre>
</div>
</div>
</div>

<div id="outline-container-org94e7568" class="outline-2">
<h2 id="org94e7568">docker push</h2>
<div class="outline-text-2" id="text-org94e7568">
<ul class="org-ul">
<li><a href="https://www.cnblogs.com/zheh/p/9168346.html">https://www.cnblogs.com/zheh/p/9168346.html</a></li>
</ul>

<div class="org-src-container">
<pre class="src src-shell">dk tag mysql:5.7 harbor.devops.kubesphere.local:30280/library/mysql_57:5.7
dk push harbor.devops.kubesphere.local:30280/library/mysql_57:5.7
</pre>
</div>
</div>
</div>


<div id="outline-container-org3233b9b" class="outline-2">
<h2 id="org3233b9b">Dockfile</h2>
<div class="outline-text-2" id="text-org3233b9b">
<ul class="org-ul">
<li><a href="https://www.jianshu.com/p/2fba3bf588ba">https://www.jianshu.com/p/2fba3bf588ba</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgf9ed515" class="outline-2">
<h2 id="orgf9ed515">常用命令</h2>
<div class="outline-text-2" id="text-orgf9ed515">
</div>
<div id="outline-container-orgf8295b6" class="outline-3">
<h3 id="orgf8295b6">help</h3>
<div class="outline-text-3" id="text-orgf8295b6">
<div class="org-src-container">
<pre class="src src-shell">$ docker -h
$ docker commond -h
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d65341" class="outline-3">
<h3 id="org4d65341">通过Dockfile构建docker镜像</h3>
<div class="outline-text-3" id="text-org4d65341">
<div class="org-src-container">
<pre class="src src-shell">$ docker build -t &lt;&#38236;&#20687;&#21517;&gt; &lt;Dockerfile&#36335;&#24452;&gt;  <span style="color: #75715E;">#</span><span style="color: #75715E;">&#36890;&#36807;Dockfile&#26500;&#24314;docker&#38236;&#20687;</span>

$ docker build -t xx/gitlab .                <span style="color: #75715E;">#</span><span style="color: #75715E;">&#22914;Dockerfile&#22312;&#24403;&#21069;&#36335;&#24452;&#65306;</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org5d8c10a" class="outline-3">
<h3 id="org5d8c10a">run</h3>
<div class="outline-text-3" id="text-org5d8c10a">
<p>
&gt; docker run -it image_id bash
</p>
</div>
</div>


<div id="outline-container-org2ebee1d" class="outline-3">
<h3 id="org2ebee1d">exec</h3>
<div class="outline-text-3" id="text-org2ebee1d">
<p>
&gt; docker exec -it container_id bash
</p>
</div>
</div>

<div id="outline-container-orgdd94df9" class="outline-3">
<h3 id="orgdd94df9">save &amp;&amp; load &amp;&amp; tag</h3>
<div class="outline-text-3" id="text-orgdd94df9">
<div class="org-src-container">
<pre class="src src-shell">
dk save 03b5ab5bcd91 &gt; ./tw_4.0.tar
dk load &lt; ./tw_4.0.tar

or

dk save 03b5ab5bcd91 -o ./tw_4.0.tar
dk load -i ./tw_4.0.tar

dk tag 03b5ab5bcd91 tw:4.0
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7688bf" class="outline-3">
<h3 id="orgb7688bf">后台运行(-d)、并暴露端口(-p)</h3>
<div class="outline-text-3" id="text-orgb7688bf">
<ul class="org-ul">
<li>docker run -d -p 33301:22 centos6-ssh</li>
<li>docker run -d -P centos6-ssh</li>

<li>-p 小写p,指定loc端口映射到容器内端口</li>
<li>-P 大学P,容器内端口自动映射到loc端口</li>
<li>-d 后台运行</li>
<li>-t 在新容器内指定一个伪终端或终端。</li>
<li>-i 允许你对容器内的标准输入 (STDIN) 进行交互</li>
</ul>
</div>
</div>

<div id="outline-container-orga07df4e" class="outline-3">
<h3 id="orga07df4e">从container中拷贝文件出来</h3>
<div class="outline-text-3" id="text-orga07df4e">
<ul class="org-ul">
<li>sudo docker cp 7bb0e258aefe:/etc/debian_version .</li>
<li>拷贝7bb0e258aefe中的/etc/debian_version到当前目录下。</li>
</ul>
<p>
注意：
</p>
<ul class="org-ul">
<li>只要7bb0e258aefe没有被删除，文件命名空间就还在，可以放心的把exit状态的container的文件拷贝出来</li>
</ul>
</div>
</div>

<div id="outline-container-org38d57e1" class="outline-3">
<h3 id="org38d57e1">删除镜像报错(image has dependent child images)</h3>
<div class="outline-text-3" id="text-org38d57e1">
<ul class="org-ul">
<li><a href="http://www.ibloger.net/article/3217.html">http://www.ibloger.net/article/3217.html</a></li>
</ul>
</div>
</div>
</div>



<div id="outline-container-org6fe3fb9" class="outline-2">
<h2 id="org6fe3fb9">踩坑</h2>
<div class="outline-text-2" id="text-org6fe3fb9">
</div>
<div id="outline-container-org938cbb4" class="outline-3">
<h3 id="org938cbb4">tw</h3>
<div class="outline-text-3" id="text-org938cbb4">
<ul class="org-ul">
<li>构建</li>
<li>hostname</li>
<li>system_id</li>
<li>sidekiq验证</li>
<li>容器启动退出</li>
</ul>
</div>
</div>

<div id="outline-container-org53e85bd" class="outline-3">
<h3 id="org53e85bd">docker search 报错</h3>
<div class="outline-text-3" id="text-org53e85bd">
<div class="org-src-container">
<pre class="src src-shell">Error response from daemon: Get https://index.docker.io/v1/search?<span style="color: #FD971F;">q</span>=mysql&amp;<span style="color: #FD971F;">n</span>=25: Service Unavailable
</pre>
</div>

<p>
<b>解决办法：</b>
</p>
<ul class="org-ul">
<li><a href="https://segmentfault.com/a/1190000016083023?utm_source=tag-newest">https://segmentfault.com/a/1190000016083023?utm_source=tag-newest</a></li>
</ul>
</div>
</div>


<div id="outline-container-org28272d7" class="outline-3">
<h3 id="org28272d7">harbor</h3>
<div class="outline-text-3" id="text-org28272d7">
<ul class="org-ul">
<li>https,http</li>
<li>harbor.devops.kubesphere.local:30280 必须固定，且配置hosts映射</li>
<li>账户push权限</li>
<li>push之前必须打tag</li>
</ul>
</div>
</div>

<div id="outline-container-org62ba19f" class="outline-3">
<h3 id="org62ba19f">docker &#x2013;link</h3>
<div class="outline-text-3" id="text-org62ba19f">
<ul class="org-ul">
<li><a href="https://www.jianshu.com/p/21d66ca6115e">https://www.jianshu.com/p/21d66ca6115e</a></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgba0f606" class="outline-2">
<h2 id="orgba0f606">docker镜像加速</h2>
<div class="outline-text-2" id="text-orgba0f606">
<blockquote>
<p class="verse">
<br>
适用于：<br>
Ubuntu 16.04+、Debian 8+、CentOS 7+<br>
<br>
</p>
</blockquote>

<p>
创建或修改  <code>/etc/docker/daemon.json</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-<span style="color: #E6DB74;">'EOF'</span>
<span style="color: #E6DB74; font-weight: bold;">{</span>
<span style="color: #E6DB74; font-weight: bold;">    "registry-mirrors": [</span>
<span style="color: #E6DB74; font-weight: bold;">        "https://1nj0zren.mirror.aliyuncs.com",</span>
<span style="color: #E6DB74; font-weight: bold;">        "https://docker.mirrors.ustc.edu.cn",</span>
<span style="color: #E6DB74; font-weight: bold;">        "http://f1361db2.m.daocloud.io",</span>
<span style="color: #E6DB74; font-weight: bold;">        "https://registry.docker-cn.com"</span>
<span style="color: #E6DB74; font-weight: bold;">    ]</span>
<span style="color: #E6DB74; font-weight: bold;">}</span>
<span style="color: #E6DB74; font-weight: bold;">EOF</span>
sudo systemctl daemon-reload
sudo systemctl restart docker

</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd087be" class="outline-2">
<h2 id="orgbd087be">检查加速器是否生效</h2>
<div class="outline-text-2" id="text-orgbd087be">
<ul class="org-ul">
<li>命令行执行 docker info，如果从结果中看到了如下内容，说明配置成功。</li>
</ul>
<pre class="example">
Registry Mirrors:
 [...]
 https://registry.docker-cn.com/
</pre>
</div>
</div>

<div id="outline-container-org111215c" class="outline-2">
<h2 id="org111215c">Docker Hub 镜像加速器列表</h2>
<div class="outline-text-2" id="text-org111215c">
<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">名称</th>
<th scope="col" class="org-left">地址</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Docker 中国官方镜像</td>
<td class="org-left"><a href="https://registry.docker-cn.com">https://registry.docker-cn.com</a></td>
</tr>

<tr>
<td class="org-left">Azure 中国镜像</td>
<td class="org-left"><a href="https://dockerhub.azk8s.cn">https://dockerhub.azk8s.cn</a></td>
</tr>

<tr>
<td class="org-left">科大镜像站</td>
<td class="org-left"><a href="https://docker.mirrors.ustc.edu.cn">https://docker.mirrors.ustc.edu.cn</a></td>
</tr>

<tr>
<td class="org-left">七牛云</td>
<td class="org-left"><a href="https://reg-mirror.qiniu.com">https://reg-mirror.qiniu.com</a></td>
</tr>

<tr>
<td class="org-left">网易云</td>
<td class="org-left"><a href="https://hub-mirror.c.163.com">https://hub-mirror.c.163.com</a></td>
</tr>

<tr>
<td class="org-left">腾讯云</td>
<td class="org-left"><a href="https://mirror.ccs.tencentyun.com">https://mirror.ccs.tencentyun.com</a></td>
</tr>
</tbody>
</table>
</div>
</div>




<div id="outline-container-org3be8e65" class="outline-2">
<h2 id="org3be8e65">延伸阅读</h2>
<div class="outline-text-2" id="text-org3be8e65">
<ul class="org-ul">
<li><a href="https://www.runoob.com/w3cnote/docker-tricks.html">https://www.runoob.com/w3cnote/docker-tricks.html</a></li>
<li><a href="https://www.runoob.com/docker/docker-container-usage.html">https://www.runoob.com/docker/docker-container-usage.html</a></li>
<li><a href="https://www.jianshu.com/p/cc5178f4b718">https://www.jianshu.com/p/cc5178f4b718</a></li>
<li><a href="http://www.dockerinfo.net/document">http://www.dockerinfo.net/document</a></li>
<li><a href="https://www.infoq.cn/article/3-simple-tricks-for-smaller-docker-images">https://www.infoq.cn/article/3-simple-tricks-for-smaller-docker-images</a></li>
<li><a href="https://juejin.cn/post/6844903840303546376">https://juejin.cn/post/6844903840303546376</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2019-07-26 Fri 08:17</p>
</div>
</body>
</html>
