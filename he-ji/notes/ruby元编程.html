<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ruby元编程</title>
<meta name="generator" content="Org Mode" />
<link rel='shortcut icon' href='http://yangk.org/org_themes/favicon.ico' type='image/x-icon' />
           <link rel='stylesheet' href='http://yangk.org/org_themes/style.css' type='text/css'  />
           <script type='module' src='http://yangk.org/org_themes/main.js' defer></script>
<meta name="card" content="">
</head>
<body>
<div id="content" class="content">
<h1 class="title">Ruby元编程</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org763f48b">你能在Ruby中提供map（＆：method）语法的参数吗？</a>
<ul>
<li><a href="#org8ee5086">问题</a></li>
<li><a href="#org7ecd0e5">解决办法</a></li>
<li><a href="#org5c64bec">with升级</a></li>
<li><a href="#org3b23e27">另一种解决办法：</a></li>
</ul>
</li>
<li><a href="#orgb3ba3da">外链</a></li>
</ul>
</div>
</div>

<div id="outline-container-org763f48b" class="outline-2">
<h2 id="org763f48b">你能在Ruby中提供map（＆：method）语法的参数吗？</h2>
<div class="outline-text-2" id="text-org763f48b">
</div>
<div id="outline-container-org8ee5086" class="outline-3">
<h3 id="org8ee5086">问题</h3>
<div class="outline-text-3" id="text-org8ee5086">
<div class="org-src-container">
<pre class="src src-ruby">a = <span style="color: #AE81FF;">[</span>1,3,5,7,9<span style="color: #AE81FF;">]</span>
a.map <span style="color: #AE81FF;">{</span>|x| x + 2<span style="color: #AE81FF;">}</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; [3, 5, 7, 9, 11]</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org7ecd0e5" class="outline-3">
<h3 id="org7ecd0e5">解决办法</h3>
<div class="outline-text-3" id="text-org7ecd0e5">
<p>
您可以在with上创建一个简单的补丁，如下所示：
</p>
<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #F92672;">class</span> <span style="color: #66D9EF;">Symbol</span>
  <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">with</span><span style="color: #AE81FF;">(</span>*args, &amp;block<span style="color: #AE81FF;">)</span>
    -&gt;<span style="color: #AE81FF;">(</span><span style="color: #F92672;">caller</span>, *rest<span style="color: #AE81FF;">)</span> <span style="color: #AE81FF;">{</span> <span style="color: #F92672;">caller</span>.send<span style="color: #66D9EF;">(</span><span style="color: #F92672;">self</span>, *rest, *args, &amp;block<span style="color: #66D9EF;">)</span> <span style="color: #AE81FF;">}</span>
  <span style="color: #F92672;">end</span>
<span style="color: #F92672;">end</span>

</pre>
</div>

<p>
这将使您不仅可以这样做：
</p>
<div class="org-src-container">
<pre class="src src-ruby">a = <span style="color: #AE81FF;">[</span>1,3,5,7,9<span style="color: #AE81FF;">]</span>
a.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:+</span>.with<span style="color: #66D9EF;">(</span>2<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; [3, 5, 7, 9, 11]</span>
</pre>
</div>

<p>
还有很多其他很酷的东西，比如传递多个参数：
</p>

<div class="org-src-container">
<pre class="src src-ruby">arr = <span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">"abc"</span>, <span style="color: #E6DB74;">"babc"</span>, <span style="color: #E6DB74;">"great"</span>, <span style="color: #E6DB74;">"fruit"</span><span style="color: #AE81FF;">]</span>
arr.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:center</span>.with<span style="color: #66D9EF;">(</span>20, <span style="color: #E6DB74;">'*'</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; ["********abc*********", "********babc********", "*******great********", "*******fruit********"]</span>

arr.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:[]</span>.with<span style="color: #66D9EF;">(</span>1, 3<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; ["bc", "abc", "rea", "rui"]</span>
arr.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:[]</span>.with<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">/a(.*)/</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; ["abc", "abc", "at", nil]</span>
arr.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:[]</span>.with<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">/a(.*)/</span>, 1<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; ["bc", "bc", "t", nil]</span>


<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">'0'</span>, <span style="color: #E6DB74;">'1'</span><span style="color: #66D9EF;">]</span>, <span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">'2'</span>, <span style="color: #E6DB74;">'3'</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">]</span>.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:map</span>.with<span style="color: #66D9EF;">(</span>&amp;<span style="color: #AE81FF;">:to_i</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; [[0, 1], [2, 3]]</span>
<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">%w(a b)</span>, <span style="color: #E6DB74;">%w(c d)</span><span style="color: #AE81FF;">]</span>.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:inject</span>.with<span style="color: #66D9EF;">(</span>&amp;<span style="color: #AE81FF;">:+</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; ["ab", "cd"]</span>
<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span>1..5<span style="color: #66D9EF;">)</span>, <span style="color: #66D9EF;">(</span>6..10<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:map</span>.with<span style="color: #66D9EF;">(</span>&amp;<span style="color: #AE81FF;">:*</span>.with<span style="color: #A6E22E;">(</span>2<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; [[2, 4, 6, 8, 10], [12, 14, 16, 18, 20]]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5c64bec" class="outline-3">
<h3 id="org5c64bec">with升级</h3>
<div class="outline-text-3" id="text-org5c64bec">
<p>
如果将with方法重命名为call，则可以创建更短的语法。在这种情况下，ruby具有此特殊方法的内置快捷方式.()。
</p>

<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #F92672;">class</span> <span style="color: #66D9EF;">Symbol</span>
  <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">call</span><span style="color: #AE81FF;">(</span>*args, &amp;block<span style="color: #AE81FF;">)</span>
    -&gt;<span style="color: #AE81FF;">(</span><span style="color: #F92672;">caller</span>, *rest<span style="color: #AE81FF;">)</span> <span style="color: #AE81FF;">{</span> <span style="color: #F92672;">caller</span>.send<span style="color: #66D9EF;">(</span><span style="color: #F92672;">self</span>, *rest, *args, &amp;block<span style="color: #66D9EF;">)</span> <span style="color: #AE81FF;">}</span>
  <span style="color: #F92672;">end</span>
<span style="color: #F92672;">end</span>
</pre>
</div>

<p>
所以你可以使用上面这样的：
</p>
<div class="org-src-container">
<pre class="src src-ruby">a = <span style="color: #AE81FF;">[</span>1,3,5,7,9<span style="color: #AE81FF;">]</span>
a.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:+</span>.<span style="color: #66D9EF;">(</span>2<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; [3, 5, 7, 9, 11]</span>

<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span>1..5<span style="color: #66D9EF;">)</span>, <span style="color: #66D9EF;">(</span>6..10<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>.map<span style="color: #AE81FF;">(</span>&amp;<span style="color: #AE81FF;">:map</span>.<span style="color: #66D9EF;">(</span>&amp;<span style="color: #AE81FF;">:*</span>.<span style="color: #A6E22E;">(</span>2<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; [[2, 4, 6, 8, 10], [12, 14, 16, 18, 20]]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b23e27" class="outline-3">
<h3 id="org3b23e27">另一种解决办法：</h3>
<div class="outline-text-3" id="text-org3b23e27">
<p>
引入Facets gem，而不是自己修补核心类
</p>
<div class="org-src-container">
<pre class="src src-ruby"><span style="color: #F92672;">require</span> <span style="color: #E6DB74;">'facets'</span>
a = <span style="color: #AE81FF;">[</span>1,3,5,7,9<span style="color: #AE81FF;">]</span>
a.map &amp;<span style="color: #AE81FF;">:+</span>.<span style="color: #AE81FF;">(</span>2<span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">=&gt; [3, 5, 7, 9, 11]</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb3ba3da" class="outline-2">
<h2 id="orgb3ba3da">外链</h2>
<div class="outline-text-2" id="text-orgb3ba3da">
<ul class="org-ul">
<li><a href="https://www.itranslater.com/qa/details/2325791262097540096">ruby元编程</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2019-07-31 Wed 20:21</p>
</div>
</body>
</html>
